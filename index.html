<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Regnum Online Old World Map</title>

  <!-- Basic metadata -->
  <meta name="description" content="Interactive tiled map viewer for Regnum Online Old World. Pan and zoom the stitched map using Leaflet.">
  <meta name="keywords" content="Regnum Online, map, tiles, Leaflet, gaming, Old World, nostalgia">
  <meta name="author" content="Joshua Treudler">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#0d6efd">

  <!-- Social preview -->
  <meta property="og:title" content="Regnum Online Old World Map">
  <meta property="og:description" content="Interactive tiled map viewer for Regnum Online Old World.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/preview.png">
  <meta property="og:url" content="">
  <meta name="twitter:card" content="summary_large_image">

  <link rel="icon" href="assets/favicon.png" sizes="32x32">
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    html,body,#map{height:100%;margin:0;padding:0}
    /* Background image shown behind tiles when panning outside bounds */
    #map{width:100vw;height:100vh; background: url('assets/background.jpg') center center / cover no-repeat}

    /* Bottom-right author notice */
    #attribution{
      position: absolute;
      right: 12px;
      bottom: 12px;
      background: rgba(0,0,0,0.55);
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      z-index: 1000;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height: 1;
    }
    #attribution a{ color: #fff; text-decoration: underline }
    /* Top-left logo */
    #logo{
      position: absolute;
      left: 12px; /* keep near edge but avoid default controls */
      top: 8px;
      width: 200px; /* increased size */
      height: auto;
      z-index: 1000;
      pointer-events: none;
    }
    /* Right-side stacked in-game map thumbnails */
    #side-maps{
      position: absolute;
      right: 12px;
      top: 50%; /* vertically center */
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1000;
      pointer-events: auto;
      align-items: flex-end;
      /* allow expanded thumbnails to overflow left */
      will-change: transform;
    }
    .side-map{
      width: 120px;
      height: auto;
      border-radius: 6px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.35);
      transition: width 160ms ease, box-shadow 160ms ease;
      display: block;
      cursor: pointer;
      object-fit: contain;
      max-height: 30vh;
    }
    .side-map:focus{ outline: 2px solid rgba(13,110,253,0.6); outline-offset: 2px }
    .side-map:hover, .side-map:focus{
      width: auto; /* show native/original width */
      height: auto;
      max-width: 60vw; /* sensible cap so it doesn't overflow the viewport */
      max-height: 80vh;
      z-index: 2000;
      box-shadow: 0 8px 26px rgba(0,0,0,0.55);
    }
    /* Reduce size on very small viewports */
    @media (max-width: 480px){
      /* On small viewports, move thumbnails to a centered bottom row
         and allow horizontal scrolling if they overflow. */
      #side-maps{
        right: 0;
        left: 0;
        bottom: 12px;
        top: auto;
        transform: none;
        justify-content: center;
        align-items: center;
        padding: 0 12px;
        gap: 8px;
        flex-direction: row;
        overflow-x: auto;
        max-width: 100%;
      }
      .side-map{
        width: 28vw;
        max-width: 120px;
        height: auto;
      }
      .side-map:hover, .side-map:focus{
        width: 35vw;
        max-width: 160px;
        max-height: 50vh;
        z-index: 2000;
        box-shadow: 0 8px 26px rgba(0,0,0,0.55);
      }
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="side-maps" aria-label="Other in-game maps">
    <img class="side-map" src="assets/ingame-maps/map-alsius-ini.png" alt="Alsuis map" title="Alsuis" tabindex="0">
    <img class="side-map" src="assets/ingame-maps/map-ignis-ini.png" alt="Ignis map" title="Ignis" tabindex="0">
    <img class="side-map" src="assets/ingame-maps/map-syrtis-ini.png" alt="Syrtis map" title="Syrtis" tabindex="0">
    <img class="side-map" src="assets/ingame-maps/map-isla-beta.png" alt="Isla map" title="Isla" tabindex="0">
  </div>
  <img id="logo" src="assets/regnum-logo.png" alt="Regnum logo">
  <div id="attribution" aria-label="Map author and source">
    <a href="https://github.com/CoR-Forum/RegnumMap-Nostalgia" target="_blank" rel="noopener noreferrer">GitHub</a>
  </div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Configuration: 3 rows, 3 columns, tiles named `tiles/{row}-{col}.png`
    const rows = 3, cols = 3;
    const tileUrl = (r, c) => `assets/tiles/${r}-${c}.png`;

    // Load first tile to determine tile pixel size at runtime
    const probe = new Image();
    probe.src = tileUrl(1,1);
    probe.onload = () => {
      const tileW = probe.width;
      const tileH = probe.height;
      const totalW = cols * tileW;
      const totalH = rows * tileH;

      // Use CRS.Simple so coordinates map directly to pixels
      // Disable the default zoomControl (placed top-left) so we can
      // re-add it on the right side.
      const map = L.map('map', {
        crs: L.CRS.Simple,
        minZoom: -2,
        maxZoom: 5,
        maxBoundsViscosity: 0.5,
        zoomControl: false
      });

      const fullBounds = [[0,0],[totalH,totalW]]; // [[y1,x1],[y2,x2]]
      map.fitBounds(fullBounds);

      // Snap back to bounds, but allow a padding buffer so users can pan slightly
      // outside before the map bounces back. Adjust `pad` (pixels) and
      // `maxBoundsViscosity` above to tune feel.
      const pad = 200; // pixels of padding outside the image
      const paddedBounds = [[-pad, -pad], [totalH + pad, totalW + pad]];
      map.setMaxBounds(paddedBounds);

      // Add each tile as an ImageOverlay positioned by pixel bounds
      // Note: flip vertical ordering so rows 1 and 3 are swapped
      for(let r=1; r<=rows; r++){
        for(let c=1; c<=cols; c++){
          const rowPos = rows - r; // invert row index
          const y1 = rowPos * tileH;
          const x1 = (c-1) * tileW;
          const y2 = (rowPos + 1) * tileH;
          const x2 = c * tileW;
          L.imageOverlay(tileUrl(r,c), [[y1,x1],[y2,x2]]).addTo(map);
        }
      }

      L.control.scale({metric: false, imperial: false}).addTo(map);
      // Add zoom control on the right side
      L.control.zoom({ position: 'topright' }).addTo(map);
    };

    probe.onerror = () => {
      console.error('Failed to load probe tile:', probe.src);
      document.getElementById('map').innerText = 'Failed to load tiles. Check tiles/ filenames.';
    };
  </script>
  
</body>
</html>
